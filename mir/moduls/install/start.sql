create table tables
(
    id      serial                      not null
        constraint tables_pkey
            primary key,
    is_del  boolean default false       not null,

    updated jsonb   default '{}'::jsonb not null,
    header  jsonb   default '{}'::jsonb not null,

    name    jsonb   default '{
      "v": null
    }'::jsonb                           not null,
    type    jsonb   default '{
      "v": null
    }'::jsonb                           not null
--   tree_node_id         jsonb   default '{"v": null}'::jsonb               not null,
--
--   title                jsonb   default '{"v": null}'::jsonb               not null,
--   order_field          jsonb   default '{"v": null}'::jsonb               not null,
--   sort                 jsonb   default '{"v": null}'::jsonb               not null,
--   insertable           jsonb   default '{"v": null}'::jsonb               not null,
--   category             jsonb   default '{"v": null}'::jsonb               not null,
--   deleting             jsonb   default '{"v": null}'::jsonb               not null,
--   description          jsonb   default '{"v": null}'::jsonb               not null,
--   main_field           jsonb   default '{"v": null}'::jsonb               not null,
--   actual               jsonb   default '{"v": null}'::jsonb               not null,
--   open                 jsonb   default '{"v": null}'::jsonb               not null,
--   indexes              jsonb   default '{"v": null}'::jsonb               not null,
--   cycles_access_type   jsonb   default '{"v": null}'::jsonb               not null,
--   row_format           jsonb   default '{"v": null}'::jsonb               not null,
--   csv_roles            jsonb   default '{"v": null}'::jsonb               not null,
--   delete_roles         jsonb   default '{"v": null}'::jsonb               not null,
--   insert_roles         jsonb   default '{"v": null}'::jsonb               not null,
--   duplicating          jsonb   default '{"v": null}'::jsonb               not null,
--   duplicate_roles      jsonb   default '{"v": null}'::jsonb               not null,
--   panel                jsonb   default '{"v": null}'::jsonb               not null,
--   delete_timer         jsonb   default '{"v": null}'::jsonb               not null,
--   with_order_field     jsonb   default '{"v": null}'::jsonb               not null,
--   recalc_in_reorder    jsonb   default '{"v": null}'::jsonb               not null,
--   order_desc           jsonb   default '{"v": null}'::jsonb               not null,
--   order_roles          jsonb   default '{"v": null}'::jsonb               not null,
--   table_format         jsonb   default '{"v": null}'::jsonb               not null,
--   calculate_by_columns jsonb   default '{"v": null}'::jsonb               not null,
--   top                  jsonb   default '{"v": null}'::jsonb               not null,
--   edit_roles           jsonb   default '{"v": null}'::jsonb               not null,
--   read_roles           jsonb   default '{"v": null}'::jsonb               not null,
--   tree_off_roles       jsonb   default '{"v": null}'::jsonb               not null,
--   csv_edit_roles       jsonb   default '{"v": []}'::jsonb                 not null,
--   fields_actuality     jsonb   default '{"v": "2018-06-14 00:00"}'::jsonb not null,
--   fields_sets          jsonb   default '{"v": null}'::jsonb               not null
);


INSERT INTO tables (type, name)
VALUES ('{
  "v": "simple"
}', '{
  "v": "tables"
}');
INSERT INTO tables (type, name)
VALUES ('{
  "v": "simple"
}', '{
  "v": "tables_fields"
}');
INSERT INTO tables (type, name)
VALUES ('{
  "v": "simple"
}', '{
  "v": "roles"
}');
INSERT INTO tables (type, name)
VALUES ('{
  "v": "simple"
}', '{
  "v": "tree"
}');

INSERT INTO tables (type, name)
VALUES ('{
  "v": "simple"
}', '{
  "v": "table_categories"
}');

INSERT INTO tables (type, name)
VALUES ('{
  "v": "simple"
}', '{
  "v": "settings"
}');

-- tables_fields

create table tables_fields
(
    id         serial                      not null
        constraint tables_fields_id_pk
            primary key,
    table_id   jsonb   default '{}'::jsonb not null,
    name       jsonb   default '{}'::jsonb not null,
    data       json    default '{}'::json  not null,
    ord        jsonb   default '{}'::jsonb not null,
    title      jsonb   default '{}'::jsonb not null,
    category   jsonb   default '{}'::jsonb not null,
    is_del     boolean default false       not null,
    data_src   jsonb   default '{
      "v": null
    }'::jsonb                              not null,
    table_name jsonb   default '{
      "v": null
    }'::jsonb                              not null,
    version    jsonb   default '{
      "v": null
    }'::jsonb                              not null
);

create index tables_fields___ind___table_id
    on tables_fields ((table_id ->> 'v'::text));


-- INSERT INTO tables_fields (table_id, name, data, ord, title, category, is_del, data_src, table_name) VALUES ('{"v": "2"}', '{"v": "table_id"}', '{"v":{"type":"select","width":300,"hidden":false,"editable":false,"multiple":false,"required":false,"showInWeb":true,"showInXml":true,"codeSelect":{"=":"SelectListAssoc(table:\"0\";field:\"1\";order:\"2\";section:\"3\")","==strings==":["''tables","''title","''title","''category"]},"filterable":true,"insertable":true,"apiEditable":false,"apiInsertable":false,"codeOnlyInAdd":false,"printTextfull":false,"CodeActionOnAdd":false,"copyOnDuplicate":true,"warningEditPanel":false,"CodeActionOnChange":false,"CodeActionOnDelete":false,"codeSelectIndividual":false,"hideInPanelIfBlocked":false}}', '{"v": "10"}', '{"v": "Название таблицы"}', '{"v": "column"}', false, '{"v": {"code": {"Val": "= : ", "isOn": false}, "help": {"Val": "", "isOn": false}, "type": {"Val": "select", "isOn": true}, "width": {"Val": 300, "isOn": true}, "format": {"Val": "f1=:", "isOn": false}, "hidden": {"Val": false, "isOn": true}, "values": {"Val": [], "isOn": false}, "default": {"Val": "", "isOn": false}, "editable": {"Val": false, "isOn": true}, "logRoles": {"Val": ["1"], "isOn": false}, "multiple": {"Val": false, "isOn": true}, "required": {"Val": false, "isOn": true}, "unitType": {"Val": "", "isOn": false}, "webRoles": {"Val": ["1"], "isOn": false}, "xmlRoles": {"Val": ["1"], "isOn": false}, "editRoles": {"Val": ["1"], "isOn": false}, "errorText": {"Val": "", "isOn": false}, "showInWeb": {"Val": true, "isOn": true}, "showInXml": {"Val": true, "isOn": true}, "codeAction": {"Val": "= :", "isOn": false}, "codeSelect": {"Val": "=:SelectListAssoc(table: ''tables'';field: ''title''; order: ''title''; section: ''category'' ) ", "isOn": true}, "filterable": {"Val": true, "isOn": true}, "insertable": {"Val": true, "isOn": true}, "panelColor": {"Val": "", "isOn": false}, "apiEditable": {"Val": false, "isOn": true}, "selectTable": {"Val": "bloki", "isOn": false}, "withEmptyVal": {"Val": "", "isOn": false}, "xmlEditRoles": {"Val": ["1"], "isOn": false}, "apiInsertable": {"Val": false, "isOn": true}, "codeOnlyInAdd": {"Val": false, "isOn": true}, "printTextfull": {"Val": false, "isOn": true}, "CodeActionOnAdd": {"Val": false, "isOn": true}, "copyOnDuplicate": {"Val": true, "isOn": true}, "multySelectView": {"Val": "0", "isOn": false}, "warningEditText": {"Val": "Точно изменить?", "isOn": false}, "warningEditPanel": {"Val": false, "isOn": true}, "selectTableAction": {"Val": "=: linkToPanel(table: ''''; id: ; field: )", "isOn": false}, "CodeActionOnChange": {"Val": false, "isOn": true}, "CodeActionOnDelete": {"Val": false, "isOn": true}, "codeSelectIndividual": {"Val": false, "isOn": true}, "hideInPanelIfBlocked": {"Val": false, "isOn": true}}}', '{"v": "tables_fields"}');
-- INSERT INTO tables_fields (table_id, name, data, ord, title, category, is_del, data_src, table_name) VALUES ('{"v": "2"}', '{"v": "name"}', '{"v":{"url":false,"code":{"=":"$name","pref":"if(condition:#category=\"0\";then:\"1\";else:$if2)","if2":"if(condition:#category=\"2\";then:\"3\";else:$if3)","if3":"if(condition:#category=\"4\";then:\"5\";else:\"6\")","name":"strAdd(str:$pref;str:$transl)","transl":"sysTranslit(str:#title)","==strings==":["\"column","\"","\"filter","\"fl_","\"footer","\"f_","\"h_"]},"type":"string","width":140,"hidden":false,"regexp":"^[a-z][a-z0-9_]{2,50}$","editable":false,"required":true,"showInWeb":true,"showInXml":true,"filterable":false,"insertable":true,"apiEditable":false,"apiInsertable":false,"codeOnlyInAdd":true,"CodeActionOnAdd":false,"copyOnDuplicate":true,"regexpErrorText":"NAME поля только маленькие латинские буквы, цифры и нижнее подчеркивание от 3 до 30 символов.","warningEditPanel":false,"CodeActionOnChange":false,"CodeActionOnDelete":false,"hideInPanelIfBlocked":false}}', '{"v": "26"}', '{"v": "NAME поля"}', '{"v": "column"}', false, '{"v": {"url": {"Val": false, "isOn": true}, "code": {"Val": "= : $name\npref: if(condition: #category=\"column\"; then: \"\"; else: $if2)\nif2: if(condition: #category=\"filter\"; then: \"fl_\"; else: $if3)\nif3: if(condition: #category=\"footer\"; then: \"f_\"; else: \"h_\")\nname: strAdd(str: $pref; str: $transl)\ntransl: sysTranslit(str: #title)", "isOn": true}, "help": {"Val": "", "isOn": false}, "type": {"Val": "string", "isOn": true}, "width": {"Val": 140, "isOn": true}, "format": {"Val": "f1=:", "isOn": false}, "hidden": {"Val": false, "isOn": true}, "openIn": {"Val": "iframe", "isOn": false}, "regexp": {"Val": "^[a-z][a-z0-9_]{2,50}$", "isOn": true}, "default": {"Val": "", "isOn": false}, "addRoles": {"Val": ["1"], "isOn": false}, "editable": {"Val": false, "isOn": true}, "logRoles": {"Val": ["1"], "isOn": false}, "required": {"Val": true, "isOn": true}, "webRoles": {"Val": ["1"], "isOn": false}, "xmlRoles": {"Val": ["1"], "isOn": false}, "editRoles": {"Val": ["1"], "isOn": false}, "errorText": {"Val": "", "isOn": false}, "showInWeb": {"Val": true, "isOn": true}, "showInXml": {"Val": true, "isOn": true}, "codeAction": {"Val": "= :", "isOn": false}, "filterable": {"Val": false, "isOn": true}, "insertable": {"Val": true, "isOn": true}, "panelColor": {"Val": "", "isOn": false}, "apiEditable": {"Val": false, "isOn": true}, "xmlEditRoles": {"Val": ["1"], "isOn": false}, "apiInsertable": {"Val": false, "isOn": true}, "codeOnlyInAdd": {"Val": true, "isOn": true}, "CodeActionOnAdd": {"Val": false, "isOn": true}, "copyOnDuplicate": {"Val": true, "isOn": true}, "regexpErrorText": {"Val": "NAME поля только маленькие латинские буквы, цифры и нижнее подчеркивание от 3 до 30 символов.", "isOn": true}, "warningEditText": {"Val": "Точно изменить?", "isOn": false}, "warningEditPanel": {"Val": false, "isOn": true}, "warningEditRegExp": {"Val": "/^someValue$/", "isOn": false}, "CodeActionOnChange": {"Val": false, "isOn": true}, "CodeActionOnDelete": {"Val": false, "isOn": true}, "hideInPanelIfBlocked": {"Val": false, "isOn": true}}}', '{"v": "tables_fields"}');
-- INSERT INTO tables_fields (table_id, name, data, ord, title, category, is_del, data_src, table_name) VALUES ('{"v": "2"}', '{"v": "category"}', '{"v":{"type":"select","width":150,"hidden":false,"default":"column","editable":true,"multiple":false,"required":false,"showInWeb":true,"showInXml":false,"codeSelect":{"=":"rowListCreate(field:\"0\"=$listitemid;field:\"1\"=$listitemtitle)","listitemid":"listitem(list:$listlist;item:0)","listitemtitle":"listitem(list:$listlist;item:1)","listlist":"if(condition:$type=$list1;then:$listcreate1;else:$if2)","if2":"if(condition:$type=$list2;then:$listcreate2;else:$listcreate3)","type":"select(table:\"2\";field:\"3\";where:\"4\"=#table_id)","list1":"listcreate(item:\"5\";item:\"6\")","listcreate1":"listcreate(item:$id1;item:$title1)","id1":"listCreate(item:\"7\";item:\"8\";item:\"9\")","title1":"listCreate(item:\"10\";item:\"11\";item:\"12\")","list2":"listcreate(item:\"13\")","listcreate2":"listcreate(item:$id2;item:$title2)","id2":"listCreate(item:\"14\";item:\"15\";item:\"16\")","title2":"listCreate(item:\"17\";item:\"18\";item:\"19\")","listcreate3":"listcreate(item:$id3;item:$title3)","id3":"listCreate(item:\"20\";item:\"21\";item:\"22\";item:\"23\")","title3":"listCreate(item:\"24\";item:\"25\";item:\"26\";item:\"27\")","==strings==":["\"value","\"title","''tables","''type","''id","\"cycles","\"simple","\"param","\"filter","\"column","\"Хэдер","\"Префильтр","\"Колонка","\"tmp","\"param","\"column","\"footer","\"Хэдер","\"Колонка","\"Футер","\"param","\"filter","\"column","\"footer","\"Хэдер","\"Префильтр","\"Колонка","\"Футер"]},"filterable":true,"insertable":true,"apiEditable":false,"apiInsertable":false,"codeOnlyInAdd":false,"printTextfull":false,"CodeActionOnAdd":false,"copyOnDuplicate":true,"warningEditPanel":false,"CodeActionOnChange":false,"CodeActionOnDelete":false,"codeSelectIndividual":true,"hideInPanelIfBlocked":false}}', '{"v": "22"}', '{"v": "Размещение"}', '{"v": "column"}', false, '{"v": {"code": {"Val": "= : ", "isOn": false}, "help": {"Val": "", "isOn": false}, "type": {"Val": "select", "isOn": true}, "width": {"Val": 150, "isOn": true}, "format": {"Val": "f1=:", "isOn": false}, "hidden": {"Val": false, "isOn": true}, "values": {"Val": {"param": "Хэдер", "column": "Колонка", "filter": "Префильтр", "footer": "Футер"}, "isOn": false}, "default": {"Val": "column", "isOn": true}, "editable": {"Val": true, "isOn": true}, "logRoles": {"Val": ["1"], "isOn": false}, "multiple": {"Val": false, "isOn": true}, "required": {"Val": false, "isOn": true}, "unitType": {"Val": "", "isOn": false}, "webRoles": {"Val": ["1"], "isOn": false}, "xmlRoles": {"Val": ["1"], "isOn": false}, "editRoles": {"Val": ["1"], "isOn": false}, "errorText": {"Val": "", "isOn": false}, "showInWeb": {"Val": true, "isOn": true}, "showInXml": {"Val": false, "isOn": true}, "codeAction": {"Val": "= :", "isOn": false}, "codeSelect": {"Val": "= : rowListCreate(field: \"value\" = $listitemid; field: \"title\" = $listitemtitle)\n\nlistitemid: listitem(list: $listlist; item: 0)\nlistitemtitle: listitem(list: $listlist; item: 1)\n\nlistlist: if(condition: $type = $list1; then: $listcreate1; else: $if2)\nif2: if(condition: $type = $list2; then: $listcreate2; else: $listcreate3)\ntype: select(table: ''tables''; field: ''type''; where: ''id'' = #table_id)\n\nlist1: listcreate(item: \"cycles\"; item: \"simple\")\nlistcreate1: listcreate(item: $id1; item: $title1)\nid1: listCreate(item: \"param\"; item: \"filter\"; item: \"column\")\ntitle1: listCreate(item: \"Хэдер\"; item: \"Префильтр\"; item: \"Колонка\")\n\nlist2: listcreate(item: \"tmp\")\nlistcreate2: listcreate(item: $id2; item: $title2)\nid2: listCreate(item: \"param\"; item: \"column\"; item: \"footer\")\ntitle2: listCreate(item: \"Хэдер\"; item: \"Колонка\"; item: \"Футер\")\n\nlistcreate3: listcreate(item: $id3; item: $title3)\nid3: listCreate(item: \"param\"; item: \"filter\"; item: \"column\"; item: \"footer\")\ntitle3: listCreate(item: \"Хэдер\"; item: \"Префильтр\"; item: \"Колонка\"; item: \"Футер\")", "isOn": true}, "filterable": {"Val": true, "isOn": true}, "insertable": {"Val": true, "isOn": true}, "panelColor": {"Val": "", "isOn": false}, "apiEditable": {"Val": false, "isOn": true}, "selectTable": {"Val": "bloki", "isOn": false}, "withEmptyVal": {"Val": "", "isOn": false}, "xmlEditRoles": {"Val": ["1"], "isOn": false}, "apiInsertable": {"Val": false, "isOn": true}, "codeOnlyInAdd": {"Val": false, "isOn": true}, "printTextfull": {"Val": false, "isOn": true}, "CodeActionOnAdd": {"Val": false, "isOn": true}, "copyOnDuplicate": {"Val": true, "isOn": true}, "multySelectView": {"Val": "0", "isOn": false}, "warningEditText": {"Val": "Точно изменить?", "isOn": false}, "warningEditPanel": {"Val": false, "isOn": true}, "selectTableAction": {"Val": "=: linkToPanel(table: ''''; id: ; field: )", "isOn": false}, "CodeActionOnChange": {"Val": false, "isOn": true}, "CodeActionOnDelete": {"Val": false, "isOn": true}, "codeSelectIndividual": {"Val": true, "isOn": true}, "hideInPanelIfBlocked": {"Val": false, "isOn": true}}}', '{"v": "tables_fields"}');
-- INSERT INTO tables_fields (table_id, name, data, ord, title, category, is_del, data_src, table_name) VALUES ('{"v": "2"}', '{"v": "data"}', '{"v":{"type":"fieldParamsResult","code":"VERYIMPOTANTCODE", "width":250,"showInWeb":false}}', '{"v": "40"}', '{"v": "Параметры поля"}', '{"v": "column"}', false, '{"v": {"type": {"Val": "fieldParams", "isOn": true}, "width": {"Val": 250, "isOn": true}, "showInWeb": {"Val": false, "isOn": true}}}', '{"v": "tables_fields"}');
-- INSERT INTO tables_fields (table_id, name, data, ord, title, category, is_del, data_src, table_name) VALUES ('{"v": "2"}', '{"v": "ord"}', '{"v":{"code":{"=":"$max+10","max":"listMax(list:$select;default:0)","select":"selectList(table:\"0\";field:\"1\";where:\"2\"=#table_id;where:\"3\"=#category)","==strings==":["''tables_fields","''ord","''table_id","''category"]},"type":"number","round":"simple","width":80,"hidden":false,"logging":true,"currency":false,"editable":true,"required":true,"showInWeb":true,"showInXml":false,"filterable":true,"insertable":true,"codeOnlyInAdd":true,"copyOnDuplicate":true,"warningEditPanel":false,"hideInPanelIfBlocked":false}}', '{"v": "23"}', '{"v": "Порядок"}', '{"v": "column"}', false, '{"v": {"code": {"Val": "=: $max+10\nmax: listMax(list: $select; default: 0)\nselect: selectList(table: ''tables_fields''; field: ''ord''; where: ''table_id'' = #table_id; where: ''category''=#category)", "isOn": true}, "help": {"Val": "", "isOn": false}, "step": {"Val": "", "isOn": false}, "type": {"Val": "number", "isOn": true}, "round": {"Val": "simple", "isOn": true}, "width": {"Val": 80, "isOn": true}, "format": {"Val": "f1=:", "isOn": false}, "hidden": {"Val": false, "isOn": true}, "regexp": {"Val": "", "isOn": false}, "default": {"Val": "", "isOn": false}, "logging": {"Val": true, "isOn": true}, "addRoles": {"Val": ["1"], "isOn": false}, "currency": {"Val": false, "isOn": true}, "editable": {"Val": true, "isOn": true}, "logRoles": {"Val": ["1"], "isOn": false}, "required": {"Val": true, "isOn": true}, "unitType": {"Val": "", "isOn": false}, "webRoles": {"Val": ["1"], "isOn": false}, "xmlRoles": {"Val": ["1"], "isOn": false}, "editRoles": {"Val": ["1"], "isOn": false}, "errorText": {"Val": "", "isOn": false}, "showInWeb": {"Val": true, "isOn": true}, "showInXml": {"Val": false, "isOn": true}, "codeAction": {"Val": "= :", "isOn": false}, "filterable": {"Val": true, "isOn": true}, "insertable": {"Val": true, "isOn": true}, "panelColor": {"Val": "", "isOn": false}, "apiEditable": {"Val": false, "isOn": false}, "xmlEditRoles": {"Val": ["1"], "isOn": false}, "apiInsertable": {"Val": false, "isOn": false}, "codeOnlyInAdd": {"Val": true, "isOn": true}, "dectimalPlaces": {"Val": 0, "isOn": false}, "CodeActionOnAdd": {"Val": false, "isOn": false}, "copyOnDuplicate": {"Val": true, "isOn": true}, "warningEditText": {"Val": "Точно изменить?", "isOn": false}, "warningEditPanel": {"Val": false, "isOn": true}, "warningEditRegExp": {"Val": "/^someValue$/", "isOn": false}, "CodeActionOnChange": {"Val": false, "isOn": false}, "CodeActionOnDelete": {"Val": false, "isOn": false}, "hideInPanelIfBlocked": {"Val": false, "isOn": true}}}', '{"v": "tables_fields"}');
-- INSERT INTO tables_fields (table_id, name, data, ord, title, category, is_del, data_src, table_name) VALUES ('{"v": "2"}', '{"v": "title"}', '{"v":{"url":false,"type":"string","width":300,"format":{"f1=":"setformat(bold:true)"},"hidden":false,"default":"Новое поле","editable":true,"required":false,"showInWeb":true,"showInXml":true,"filterable":true,"insertable":true,"apiEditable":false,"apiInsertable":false,"codeOnlyInAdd":false,"CodeActionOnAdd":false,"copyOnDuplicate":true,"warningEditPanel":false,"CodeActionOnChange":false,"CodeActionOnDelete":false,"hideInPanelIfBlocked":false}}', '{"v": "24"}', '{"v": "Заголовок поля"}', '{"v": "column"}', false, '{"v": {"url": {"Val": false, "isOn": true}, "code": {"Val": "= : ", "isOn": false}, "help": {"Val": "", "isOn": false}, "type": {"Val": "string", "isOn": true}, "width": {"Val": 300, "isOn": true}, "format": {"Val": "f1=: setformat(bold: true)", "isOn": true}, "hidden": {"Val": false, "isOn": true}, "openIn": {"Val": "iframe", "isOn": false}, "regexp": {"Val": "", "isOn": false}, "default": {"Val": "Новое поле", "isOn": true}, "editable": {"Val": true, "isOn": true}, "logRoles": {"Val": ["1"], "isOn": false}, "required": {"Val": false, "isOn": true}, "webRoles": {"Val": ["1"], "isOn": false}, "xmlRoles": {"Val": ["1"], "isOn": false}, "editRoles": {"Val": ["1"], "isOn": false}, "errorText": {"Val": "", "isOn": false}, "showInWeb": {"Val": true, "isOn": true}, "showInXml": {"Val": true, "isOn": true}, "codeAction": {"Val": "= :", "isOn": false}, "filterable": {"Val": true, "isOn": true}, "insertable": {"Val": true, "isOn": true}, "panelColor": {"Val": "", "isOn": false}, "apiEditable": {"Val": false, "isOn": true}, "xmlEditRoles": {"Val": ["1"], "isOn": false}, "apiInsertable": {"Val": false, "isOn": true}, "codeOnlyInAdd": {"Val": false, "isOn": true}, "CodeActionOnAdd": {"Val": false, "isOn": true}, "copyOnDuplicate": {"Val": true, "isOn": true}, "regexpErrorText": {"Val": "", "isOn": false}, "warningEditText": {"Val": "Точно изменить?", "isOn": false}, "warningEditPanel": {"Val": false, "isOn": true}, "CodeActionOnChange": {"Val": false, "isOn": true}, "CodeActionOnDelete": {"Val": false, "isOn": true}, "hideInPanelIfBlocked": {"Val": false, "isOn": true}}}', '{"v": "tables_fields"}');
-- INSERT INTO tables_fields (table_id, name, data, ord, title, category, is_del, data_src, table_name) VALUES ('{"v": "2"}', '{"v": "data_src"}', '{"v":{"type":"fieldParams","width":150,"default":"{}","logging":false,"editable":true,"required":true,"showInWeb":true,"insertable":true,"jsonFields":{"fieldSettings":{"url":{"type":"checkbox","title":"Показывать строку как URL","parent":"showInWeb","default":false,"required":false},"code":{"type":"code","title":"Код","default":"= : "},"help":{"type":"html","title":"Описание поля"},"step":{"type":"string","title":"Шаг округления","parent":"round"},"type":{"type":"select","title":"Тип поля","values":{"date":"Дата","file":"Файл","link":"Ярлык","text":"Текст","tree":"Селект-дерево","unic":"Уникальное","button":"Кнопка","number":"Число","select":"Селект","string":"Строка","listRow":"Список","checkbox":"Чекбокс","comments":"Комментарии","password":"Пароль","fieldParams":"Настройки"},"required":true,"valuesOrder":["string","number","select","tree","checkbox","date","button","link","text","comments","file","unic","password","listRow"]},"round":{"type":"select","title":"Округление","values":{"up":"В большую сторону","down":"В меньшую сторону","simple":"Математическое"},"default":"simple","required":true},"width":{"type":"integer","title":"Ширина по умолчанию, px","default":100,"required":true},"accept":{"type":"string","title":"Принимает файлы (mime-тип)","default":"image\/*"},"column":{"type":"string","title":"Name поля в строчной части","required":true,"categories":["filter","footer"]},"format":{"type":"code","title":"Условное форматирование ячейки","default":"f1=:"},"hidden":{"type":"checkbox","title":"Скрыто по умолчанию","parent":"showInWeb"},"openIn":{"type":"select","title":"Открывать в","parent":"url","values":{"iframe":"iframe","window":"Текущем окне","newWindow":"Новом окне"},"required":false},"regexp":{"type":"string","title":"Формат валидизации ввода (regexp)"},"values":{"type":"json","title":"Ручное создание селекта","parent":"codeSelect","default":"{}"},"default":{"type":"string","title":"Значение по умолчанию"},"logging":{"type":"checkbox","title":"С логированием","default":true,"categories":["param","column","footer"]},"addRoles":{"type":"select","title":"Добавление доступно ролям","parent":"insertable","values":[],"multiple":true},"currency":{"type":"checkbox","title":"Денежный формат","default":false,"required":false},"dateTime":{"type":"checkbox","title":"Дата-время","default":false,"required":false},"editable":{"type":"checkbox","title":"Редактируемое в WEB","parent":"showInWeb","default":true,"required":false},"logRoles":{"type":"select","title":"Лог доступен ролям","parent":"showInWeb","values":[],"multiple":true},"multiple":{"type":"checkbox","title":"Множественные значения","parent":"codeSelect","default":false},"required":{"type":"checkbox","title":"Обязательное","width":3,"required":true},"textType":{"type":"select","title":"Тип текста","values":{"css":"css","xml":"xml","html":"html","json":"Json","text":"Текст","mir":"Mir-код","javascript":"javascript"},"default":"text","required":true},"unitType":{"type":"string","title":"Единица измерения"},"webRoles":{"type":"select","title":"Видно ролям","parent":"showInWeb","values":[],"multiple":true},"xmlRoles":{"type":"select","title":"Видно ролям","parent":"showInXml","values":[],"multiple":true},"editRoles":{"type":"select","title":"Редактирование доступно ролям","parent":"editable","values":[],"multiple":true},"errorText":{"type":"string","title":"Текст ошибки","parent":"code"},"showInWeb":{"type":"checkbox","title":"Показывать в WEB","default":true},"showInXml":{"type":"checkbox","title":"Показывать в XML\/JSON","default":false,"required":false},"buttonText":{"type":"string","title":"Текст кнопки","default":"Нажми меня","required":true},"codeAction":{"type":"code","title":"Код действия","default":"= :","categories":["param","column","footer"]},"codeSelect":{"type":"code","title":"Код селекта","default":"= : selectRowListForSelect(table: ''''; field: ''''; order: '''' asc; where:  '''' = ; section: '''';  preview: '''')","required":true},"dateFormat":{"type":"string","title":"Формат вывода в интерфейс даты\/времени"},"filterable":{"type":"checkbox","title":"Фильтр по полю","parent":"showInWeb","default":false,"required":false,"categories":["column"]},"insertable":{"type":"checkbox","title":"Вводится при добавлении в WEB","parent":"showInWeb","default":true,"required":false,"categories":["column"]},"jsonFields":{"type":"json"},"panelColor":{"type":"string","title":"Цвет панели","parent":"showInWeb"},"apiEditable":{"type":"checkbox","title":"Редактируемое в XML\/JSON","parent":"showInXml","default":false,"required":false,"categories":["param","column","footer"]},"selectTable":{"type":"select","title":"Таблица селекта для изменения","parent":"codeSelect","values":[],"categories":["column","footer","param"]},"dropdownView":{"type":"checkbox","title":"Показывать выпадающее меню","parent":"showInWeb","default":true},"nameWithHash":{"type":"checkbox","title":"Имя файла с хешем в конце","default":false},"selectLength":{"type":"integer","title":"Максимальное количество выводимых элементов","parent":"showInWeb","default":50},"withEmptyVal":{"type":"string","title":"Заголовок селекта с пустым значением","parent":"codeSelect","categories":["param","column","footer"]},"xmlEditRoles":{"type":"select","title":"Редактирование доступно ролям","parent":"apiEditable","values":[],"multiple":true},"apiInsertable":{"type":"checkbox","title":"Вводится при добавлении в XML\/JSON","parent":"showInXml","default":false,"required":false,"categories":["column","filter"]},"codeOnlyInAdd":{"type":"checkbox","title":"Исполнять код только при добавлении","parent":"code","default":false},"linkFieldName":{"type":"string","required":true},"linkTableName":{"type":"string","required":true},"printTextfull":{"type":"checkbox","title":"Выводить на печать текст целиком","parent":"multiple","default":false},"dectimalPlaces":{"type":"integer","title":"Знаков после запятой","default":0},"intervalFilter":{"type":"select","title":"Интервальный","values":{"end":"Завершающий","start":"Стартовый"},"categories":["filter"]},"CodeActionOnAdd":{"type":"checkbox","title":"Выполнять код действия при добавлении","parent":"codeAction","default":false,"categories":["param","column","footer"]},"copyOnDuplicate":{"type":"checkbox","title":"Переносить значения при дублировании","categories":["column"]},"decorationColor":{"type":"string","title":"Цвет выделения","parent":"showInWeb"},"multySelectView":{"type":"select","title":"Отображение множественного селекта в ячейке","parent":"multiple","values":["Количество значений","Список значений"],"default":0},"regexpErrorText":{"type":"string","title":"Текст ошибки валидизации ввода","parent":"regexp"},"warningEditText":{"type":"string","title":"Текст предупреждения","parent":"warningEditPanel","default":"Точно изменить?","categories":["param","column","footer"]},"tableBreakBefore":{"type":"checkbox","title":"С новой строчки","parent":"showInWeb","categories":["param","filter","footer"]},"treeViewTypeFull":{"type":"checkbox","title":"Отображать путь в ячейке","parent":"codeSelect","default":true},"warningEditPanel":{"type":"checkbox","title":"Предупреждение при изменении","parent":"showInWeb","default":false,"categories":["param","column","footer"]},"selectTableAction":{"type":"code","title":"Панель селекта для изменения","parent":"selectTable","default":"=: linkToPanel(table: ''''; id: ; field: )","categories":["column","footer","param"]},"treeSelectFolders":{"type":"checkbox","title":"Папки можно выбирать","parent":"codeSelect","default":true},"uncheckAfterClick":{"type":"checkbox","title":"Снимать галочки после выполнения ","parent":"codeAction","default":false},"viewTextMaxLength":{"type":"integer","title":"Ограничение видимости текста в web (max 500)","default":100,"required":true},"warningEditRegExp":{"type":"string","title":"RegExp значения, при котором выводить предупреждение","parent":"warningEditPanel","default":"\/^someValue$\/","categories":["param","column","footer"]},"CodeActionOnChange":{"type":"checkbox","title":"Выполнять код действия при изменении","parent":"codeAction","default":false,"categories":["param","column","footer"]},"CodeActionOnDelete":{"type":"checkbox","title":"Выполнять код действия при удалении","parent":"codeAction","default":false,"categories":["column"]},"fileDuplicateOnCopy":{"type":"checkbox","title":"Дублировать файл при копировании ","default":true},"pressableOnOnlyRead":{"type":"checkbox","title":"Действие доступно при просмотре","default":false,"categories":["param","column","footer"]},"selectFilterWithAll":{"type":"checkbox","title":"Все (*ALL*)","parent":"codeSelect","default":true,"categories":["filter"]},"codeSelectIndividual":{"type":"checkbox","title":"Индивидуальный расчет селекта для каждой строки","parent":"codeSelect","default":true},"hideInPanelIfBlocked":{"type":"checkbox","title":"Скрывать блокированное в панели","parent":"showInWeb","default":false,"categories":["column"]},"selectFilterWithNone":{"type":"checkbox","title":"Ничего (*NONE*)","parent":"codeSelect","default":true,"categories":["filter"]},"closeIframeAfterClick":{"type":"checkbox","title":"Закрыть окно после выполнения ","parent":"codeAction","default":false},"selectFilterWithEmpty":{"type":"checkbox","title":"Пустое ()","parent":"codeSelect","default":false,"categories":["filter"]},"selectFilterWithAllText":{"type":"string","title":"Название для опции Все (*ALL*)","parent":"selectFilterWithAll","default":"Все","categories":["filter"]},"selectFilterWithNoneText":{"type":"string","title":"Название для опции Ничего (*NONE*)","parent":"selectFilterWithNone","default":"Ничего","categories":["filter"]},"selectFilterWithEmptyText":{"type":"string","title":"Название для опции Пустое ()","parent":"selectFilterWithEmpty","default":"Пустое","categories":["filter"]}},"fieldListParams":{"date":["width","default","dateTime","dateFormat","column","intervalFilter","copyOnDuplicate","required","showInWeb","dropdownView","insertable","addRoles","editable","editRoles","filterable","hidden","hideInPanelIfBlocked","warningEditPanel","warningEditText","warningEditRegExp","tableBreakBefore","panelColor","webRoles","logRoles","showInXml","apiInsertable","apiEditable","xmlEditRoles","xmlRoles","logging","code","codeOnlyInAdd","errorText","codeAction","CodeActionOnAdd","CodeActionOnChange","CodeActionOnDelete","format","help"],"file":["width","column","multiple","fileDuplicateOnCopy","nameWithHash","accept","required","showInWeb","dropdownView","insertable","addRoles","editable","editRoles","hidden","warningEditPanel","warningEditText","tableBreakBefore","panelColor","webRoles","logRoles","showInXml","apiInsertable","apiEditable","xmlEditRoles","xmlRoles","logging","codeAction","CodeActionOnAdd","CodeActionOnChange","CodeActionOnDelete","format","help"],"link":["width","linkTableName","linkFieldName","column","showInWeb","dropdownView","insertable","addRoles","editable","editRoles","filterable","hidden","hideInPanelIfBlocked","warningEditPanel","warningEditText","warningEditRegExp","tableBreakBefore","panelColor","webRoles","logRoles","showInXml","apiInsertable","apiEditable","xmlEditRoles","xmlRoles","logging","format","help"],"text":["width","default","textType","viewTextMaxLength","printTextfull","column","copyOnDuplicate","required","showInWeb","dropdownView","insertable","addRoles","editable","editRoles","filterable","hidden","hideInPanelIfBlocked","warningEditPanel","warningEditText","warningEditRegExp","tableBreakBefore","panelColor","webRoles","logRoles","showInXml","apiInsertable","apiEditable","xmlEditRoles","xmlRoles","logging","code","codeOnlyInAdd","errorText","codeAction","CodeActionOnAdd","CodeActionOnChange","CodeActionOnDelete","format","help"],"tree":["width","default","column","unitType","copyOnDuplicate","required","showInWeb","dropdownView","insertable","addRoles","editable","editRoles","filterable","hidden","hideInPanelIfBlocked","warningEditPanel","warningEditText","warningEditRegExp","tableBreakBefore","panelColor","webRoles","logRoles","showInXml","apiInsertable","apiEditable","xmlEditRoles","xmlRoles","logging","code","codeOnlyInAdd","errorText","codeAction","CodeActionOnAdd","CodeActionOnChange","CodeActionOnDelete","codeSelect","codeSelectIndividual","multiple","treeViewTypeFull","treeSelectFolders","printTextfull","multySelectView","withEmptyVal","selectTable","selectTableAction","selectFilterWithAll","selectFilterWithNone","selectFilterWithEmpty","values","format","help"],"unic":["width","regexp","regexpErrorText","required","showInWeb","dropdownView","insertable","addRoles","editable","editRoles","filterable","hidden","hideInPanelIfBlocked","warningEditPanel","warningEditText","warningEditRegExp","url","openIn","webRoles","logRoles","showInXml","apiInsertable","apiEditable","xmlEditRoles","xmlRoles","logging","codeAction","CodeActionOnAdd","CodeActionOnChange","CodeActionOnDelete","format","help"],"button":["width","column","buttonText","showInWeb","dropdownView","warningEditPanel","warningEditText","tableBreakBefore","panelColor","webRoles","hidden","codeAction","uncheckAfterClick","closeIframeAfterClick","pressableOnOnlyRead","format","help"],"number":["width","default","column","intervalFilter","unitType","dectimalPlaces","regexp","round","step","currency","copyOnDuplicate","required","showInWeb","dropdownView","insertable","addRoles","editable","editRoles","filterable","hidden","hideInPanelIfBlocked","warningEditPanel","warningEditText","warningEditRegExp","tableBreakBefore","panelColor","webRoles","logRoles","showInXml","apiInsertable","apiEditable","xmlEditRoles","xmlRoles","logging","code","codeOnlyInAdd","errorText","codeAction","CodeActionOnAdd","CodeActionOnChange","CodeActionOnDelete","format","help"],"select":["width","default","column","intervalFilter","unitType","copyOnDuplicate","required","showInWeb","dropdownView","insertable","addRoles","editable","editRoles","selectLength","filterable","hidden","hideInPanelIfBlocked","warningEditPanel","warningEditText","warningEditRegExp","tableBreakBefore","panelColor","webRoles","logRoles","showInXml","apiInsertable","apiEditable","xmlEditRoles","xmlRoles","logging","code","codeOnlyInAdd","errorText","codeAction","CodeActionOnAdd","CodeActionOnChange","CodeActionOnDelete","codeSelect","codeSelectIndividual","multiple","printTextfull","multySelectView","withEmptyVal","selectTable","selectTableAction","selectFilterWithAll","selectFilterWithAllText","selectFilterWithNone","selectFilterWithNoneText","selectFilterWithEmpty","selectFilterWithEmptyText","values","format","help"],"string":["width","default","column","regexp","regexpErrorText","copyOnDuplicate","required","showInWeb","dropdownView","insertable","addRoles","editable","editRoles","filterable","hidden","hideInPanelIfBlocked","warningEditPanel","warningEditText","warningEditRegExp","url","openIn","tableBreakBefore","panelColor","webRoles","logRoles","showInXml","apiInsertable","apiEditable","xmlEditRoles","xmlRoles","logging","code","codeOnlyInAdd","errorText","codeAction","CodeActionOnAdd","CodeActionOnChange","CodeActionOnDelete","format","help"],"listRow":["width","default","column","copyOnDuplicate","required","showInWeb","dropdownView","filterable","hidden","hideInPanelIfBlocked","tableBreakBefore","panelColor","webRoles","showInXml","xmlRoles","logging","code","codeOnlyInAdd","errorText","codeAction","CodeActionOnAdd","CodeActionOnChange","CodeActionOnDelete","format","help"],"checkbox":["width","default","column","copyOnDuplicate","required","showInWeb","dropdownView","insertable","addRoles","editable","editRoles","filterable","hidden","hideInPanelIfBlocked","warningEditPanel","warningEditText","tableBreakBefore","panelColor","webRoles","logRoles","showInXml","apiInsertable","apiEditable","xmlEditRoles","xmlRoles","logging","code","codeOnlyInAdd","errorText","codeAction","CodeActionOnAdd","CodeActionOnChange","CodeActionOnDelete","format","help"],"comments":["width","viewTextMaxLength","printTextfull","dateTime","copyOnDuplicate","required","showInWeb","dropdownView","insertable","addRoles","editable","editRoles","hidden","tableBreakBefore","panelColor","decorationColor","webRoles","logRoles","showInXml","apiInsertable","apiEditable","xmlEditRoles","xmlRoles","logging","codeAction","CodeActionOnAdd","CodeActionOnChange","CodeActionOnDelete","format","help"],"password":["width","column","required","showInWeb","dropdownView","insertable","addRoles","editable","editRoles","hidden","warningEditPanel","warningEditText","tableBreakBefore","panelColor","webRoles","logRoles","showInXml","apiInsertable","apiEditable","xmlEditRoles","xmlRoles","logging","codeAction","CodeActionOnAdd","CodeActionOnChange","CodeActionOnDelete","format","help"],"fieldParams":[]}},"copyOnDuplicate":true}}', '{"v": "35"}', '{"v": "Параметры поля"}', '{"v": "column"}', false, '{"v": {"type": {"Val": "fieldParams", "isOn": true}, "width": {"Val": 150, "isOn": true}, "default": {"Val": "{}", "isOn": true}, "logging": {"Val": false, "isOn": true}, "editable": {"Val": true, "isOn": true}, "required": {"Val": true, "isOn": true}, "showInWeb": {"Val": true, "isOn": true}, "insertable": {"Val": true, "isOn": true}, "jsonFields": {"Val": {"fieldSettings": {"url": {"type": "checkbox", "title": "Показывать строку как URL", "parent": "showInWeb", "default": false, "required": false}, "code": {"type": "code", "title": "Код", "default": "= : "}, "help": {"type": "html", "title": "Описание поля"}, "step": {"type": "string", "title": "Шаг округления", "parent": "round"}, "type": {"type": "select", "title": "Тип поля", "values": {"date": "Дата", "file": "Файл", "link": "Ярлык", "text": "Текст", "tree": "Селект-дерево", "unic": "Уникальное", "button": "Кнопка", "number": "Число", "select": "Селект", "string": "Строка", "listRow": "Список", "checkbox": "Чекбокс", "comments": "Комментарии", "password": "Пароль", "fieldParams": "Настройки"}, "required": true, "valuesOrder": ["string", "number", "select", "tree", "checkbox", "date", "button", "link", "text", "comments", "file", "unic", "password", "listRow"]}, "round": {"type": "select", "title": "Округление", "values": {"up": "В большую сторону", "down": "В меньшую сторону", "simple": "Математическое"}, "default": "simple", "required": true}, "width": {"type": "integer", "title": "Ширина по умолчанию, px", "default": 100, "required": true}, "accept": {"type": "string", "title": "Принимает файлы (mime-тип)", "default": "image/*"}, "column": {"type": "string", "title": "Name поля в строчной части", "required": true, "categories": ["filter", "footer"]}, "format": {"type": "code", "title": "Условное форматирование ячейки", "default": "f1=:"}, "hidden": {"type": "checkbox", "title": "Скрыто по умолчанию", "parent": "showInWeb"}, "openIn": {"type": "select", "title": "Открывать в", "parent": "url", "values": {"iframe": "iframe", "window": "Текущем окне", "newWindow": "Новом окне"}, "required": false}, "regexp": {"type": "string", "title": "Формат валидизации ввода (regexp)"}, "values": {"type": "json", "title": "Ручное создание селекта", "parent": "codeSelect", "default": "{}"}, "default": {"type": "string", "title": "Значение по умолчанию"}, "logging": {"type": "checkbox", "title": "С логированием", "default": true, "categories": ["param", "column", "footer"]}, "addRoles": {"type": "select", "title": "Добавление доступно ролям", "parent": "insertable", "values": [], "multiple": true}, "currency": {"type": "checkbox", "title": "Денежный формат", "default": false, "required": false}, "dateTime": {"type": "checkbox", "title": "Дата-время", "default": false, "required": false}, "editable": {"type": "checkbox", "title": "Редактируемое в WEB", "parent": "showInWeb", "default": true, "required": false}, "logRoles": {"type": "select", "title": "Лог доступен ролям", "parent": "showInWeb", "values": [], "multiple": true}, "multiple": {"type": "checkbox", "title": "Множественные значения", "parent": "codeSelect", "default": false}, "required": {"type": "checkbox", "title": "Обязательное", "width": 3, "required": true}, "textType": {"type": "select", "title": "Тип текста", "values": {"css": "css", "xml": "xml", "html": "html", "json": "Json", "text": "Текст", "mir": "Mir-код", "javascript": "javascript"}, "default": "text", "required": true}, "unitType": {"type": "string", "title": "Единица измерения"}, "webRoles": {"type": "select", "title": "Видно ролям", "parent": "showInWeb", "values": [], "multiple": true}, "xmlRoles": {"type": "select", "title": "Видно ролям", "parent": "showInXml", "values": [], "multiple": true}, "editRoles": {"type": "select", "title": "Редактирование доступно ролям", "parent": "editable", "values": [], "multiple": true}, "errorText": {"type": "string", "title": "Текст ошибки", "parent": "code"}, "showInWeb": {"type": "checkbox", "title": "Показывать в WEB", "default": true}, "showInXml": {"type": "checkbox", "title": "Показывать в XML/JSON", "default": false, "required": false}, "buttonText": {"type": "string", "title": "Текст кнопки", "default": "Нажми меня", "required": true}, "codeAction": {"type": "code", "title": "Код действия", "default": "= :", "categories": ["param", "column", "footer"]}, "codeSelect": {"type": "code", "title": "Код селекта", "default": "= : selectRowListForSelect(table: ''''; field: ''''; order: '''' asc; where:  '''' = ; section: '''';  preview: '''')", "required": true}, "dateFormat": {"type": "string", "title": "Формат вывода в интерфейс даты/времени"}, "filterable": {"type": "checkbox", "title": "Фильтр по полю", "parent": "showInWeb", "default": false, "required": false, "categories": ["column"]}, "insertable": {"type": "checkbox", "title": "Вводится при добавлении в WEB", "parent": "showInWeb", "default": true, "required": false, "categories": ["column"]}, "jsonFields": {"type": "json"}, "panelColor": {"type": "string", "title": "Цвет панели", "parent": "showInWeb"}, "apiEditable": {"type": "checkbox", "title": "Редактируемое в XML/JSON", "parent": "showInXml", "default": false, "required": false, "categories": ["param", "column", "footer"]}, "selectTable": {"type": "select", "title": "Таблица селекта для изменения", "parent": "codeSelect", "values": [], "categories": ["column", "footer", "param"]}, "dropdownView": {"type": "checkbox", "title": "Показывать выпадающее меню", "parent": "showInWeb", "default": true}, "nameWithHash": {"type": "checkbox", "title": "Имя файла с хешем в конце", "default": false}, "selectLength": {"type": "integer", "title": "Максимальное количество выводимых элементов", "parent": "showInWeb", "default": 50}, "withEmptyVal": {"type": "string", "title": "Заголовок селекта с пустым значением", "parent": "codeSelect", "categories": ["param", "column", "footer"]}, "xmlEditRoles": {"type": "select", "title": "Редактирование доступно ролям", "parent": "apiEditable", "values": [], "multiple": true}, "apiInsertable": {"type": "checkbox", "title": "Вводится при добавлении в XML/JSON", "parent": "showInXml", "default": false, "required": false, "categories": ["column", "filter"]}, "codeOnlyInAdd": {"type": "checkbox", "title": "Исполнять код только при добавлении", "parent": "code", "default": false}, "linkFieldName": {"type": "string", "required": true}, "linkTableName": {"type": "string", "required": true}, "printTextfull": {"type": "checkbox", "title": "Выводить на печать текст целиком", "parent": "multiple", "default": false}, "dectimalPlaces": {"type": "integer", "title": "Знаков после запятой", "default": 0}, "intervalFilter": {"type": "select", "title": "Интервальный", "values": {"end": "Завершающий", "start": "Стартовый"}, "categories": ["filter"]}, "CodeActionOnAdd": {"type": "checkbox", "title": "Выполнять код действия при добавлении", "parent": "codeAction", "default": false, "categories": ["param", "column", "footer"]}, "copyOnDuplicate": {"type": "checkbox", "title": "Переносить значения при дублировании", "categories": ["column"]}, "decorationColor": {"type": "string", "title": "Цвет выделения", "parent": "showInWeb"}, "multySelectView": {"type": "select", "title": "Отображение множественного селекта в ячейке", "parent": "multiple", "values": ["Количество значений", "Список значений"], "default": 0}, "regexpErrorText": {"type": "string", "title": "Текст ошибки валидизации ввода", "parent": "regexp"}, "warningEditText": {"type": "string", "title": "Текст предупреждения", "parent": "warningEditPanel", "default": "Точно изменить?", "categories": ["param", "column", "footer"]}, "tableBreakBefore": {"type": "checkbox", "title": "С новой строчки", "parent": "showInWeb", "categories": ["param", "filter", "footer"]}, "treeViewTypeFull": {"type": "checkbox", "title": "Отображать путь в ячейке", "parent": "codeSelect", "default": true}, "warningEditPanel": {"type": "checkbox", "title": "Предупреждение при изменении", "parent": "showInWeb", "default": false, "categories": ["param", "column", "footer"]}, "selectTableAction": {"type": "code", "title": "Панель селекта для изменения", "parent": "selectTable", "default": "=: linkToPanel(table: ''''; id: ; field: )", "categories": ["column", "footer", "param"]}, "treeSelectFolders": {"type": "checkbox", "title": "Папки можно выбирать", "parent": "codeSelect", "default": true}, "uncheckAfterClick": {"type": "checkbox", "title": "Снимать галочки после выполнения ", "parent": "codeAction", "default": false}, "viewTextMaxLength": {"type": "integer", "title": "Ограничение видимости текста в web (max 500)", "default": 100, "required": true}, "warningEditRegExp": {"type": "string", "title": "RegExp значения, при котором выводить предупреждение", "parent": "warningEditPanel", "default": "/^someValue$/", "categories": ["param", "column", "footer"]}, "CodeActionOnChange": {"type": "checkbox", "title": "Выполнять код действия при изменении", "parent": "codeAction", "default": false, "categories": ["param", "column", "footer"]}, "CodeActionOnDelete": {"type": "checkbox", "title": "Выполнять код действия при удалении", "parent": "codeAction", "default": false, "categories": ["column"]}, "fileDuplicateOnCopy": {"type": "checkbox", "title": "Дублировать файл при копировании ", "default": true}, "pressableOnOnlyRead": {"type": "checkbox", "title": "Действие доступно при просмотре", "default": false, "categories": ["param", "column", "footer"]}, "selectFilterWithAll": {"type": "checkbox", "title": "Все (*ALL*)", "parent": "codeSelect", "default": true, "categories": ["filter"]}, "codeSelectIndividual": {"type": "checkbox", "title": "Индивидуальный расчет селекта для каждой строки", "parent": "codeSelect", "default": true}, "hideInPanelIfBlocked": {"type": "checkbox", "title": "Скрывать блокированное в панели", "parent": "showInWeb", "default": false, "categories": ["column"]}, "selectFilterWithNone": {"type": "checkbox", "title": "Ничего (*NONE*)", "parent": "codeSelect", "default": true, "categories": ["filter"]}, "closeIframeAfterClick": {"type": "checkbox", "title": "Закрыть окно после выполнения ", "parent": "codeAction", "default": false}, "selectFilterWithEmpty": {"type": "checkbox", "title": "Пустое ()", "parent": "codeSelect", "default": false, "categories": ["filter"]}, "selectFilterWithAllText": {"type": "string", "title": "Название для опции Все (*ALL*)", "parent": "selectFilterWithAll", "default": "Все", "categories": ["filter"]}, "selectFilterWithNoneText": {"type": "string", "title": "Название для опции Ничего (*NONE*)", "parent": "selectFilterWithNone", "default": "Ничего", "categories": ["filter"]}, "selectFilterWithEmptyText": {"type": "string", "title": "Название для опции Пустое ()", "parent": "selectFilterWithEmpty", "default": "Пустое", "categories": ["filter"]}}, "fieldListParams": {"date": ["width", "default", "dateTime", "dateFormat", "column", "intervalFilter", "copyOnDuplicate", "required", "showInWeb", "dropdownView", "insertable", "addRoles", "editable", "editRoles", "filterable", "hidden", "hideInPanelIfBlocked", "warningEditPanel", "warningEditText", "warningEditRegExp", "tableBreakBefore", "panelColor", "webRoles", "logRoles", "showInXml", "apiInsertable", "apiEditable", "xmlEditRoles", "xmlRoles", "logging", "code", "codeOnlyInAdd", "errorText", "codeAction", "CodeActionOnAdd", "CodeActionOnChange", "CodeActionOnDelete", "format", "help"], "file": ["width", "column", "multiple", "fileDuplicateOnCopy", "nameWithHash", "accept", "required", "showInWeb", "dropdownView", "insertable", "addRoles", "editable", "editRoles", "hidden", "warningEditPanel", "warningEditText", "tableBreakBefore", "panelColor", "webRoles", "logRoles", "showInXml", "apiInsertable", "apiEditable", "xmlEditRoles", "xmlRoles", "logging", "codeAction", "CodeActionOnAdd", "CodeActionOnChange", "CodeActionOnDelete", "format", "help"], "link": ["width", "linkTableName", "linkFieldName", "column", "showInWeb", "dropdownView", "insertable", "addRoles", "editable", "editRoles", "filterable", "hidden", "hideInPanelIfBlocked", "warningEditPanel", "warningEditText", "warningEditRegExp", "tableBreakBefore", "panelColor", "webRoles", "logRoles", "showInXml", "apiInsertable", "apiEditable", "xmlEditRoles", "xmlRoles", "logging", "format", "help"], "text": ["width", "default", "textType", "viewTextMaxLength", "printTextfull", "column", "copyOnDuplicate", "required", "showInWeb", "dropdownView", "insertable", "addRoles", "editable", "editRoles", "filterable", "hidden", "hideInPanelIfBlocked", "warningEditPanel", "warningEditText", "warningEditRegExp", "tableBreakBefore", "panelColor", "webRoles", "logRoles", "showInXml", "apiInsertable", "apiEditable", "xmlEditRoles", "xmlRoles", "logging", "code", "codeOnlyInAdd", "errorText", "codeAction", "CodeActionOnAdd", "CodeActionOnChange", "CodeActionOnDelete", "format", "help"], "tree": ["width", "default", "column", "unitType", "copyOnDuplicate", "required", "showInWeb", "dropdownView", "insertable", "addRoles", "editable", "editRoles", "filterable", "hidden", "hideInPanelIfBlocked", "warningEditPanel", "warningEditText", "warningEditRegExp", "tableBreakBefore", "panelColor", "webRoles", "logRoles", "showInXml", "apiInsertable", "apiEditable", "xmlEditRoles", "xmlRoles", "logging", "code", "codeOnlyInAdd", "errorText", "codeAction", "CodeActionOnAdd", "CodeActionOnChange", "CodeActionOnDelete", "codeSelect", "codeSelectIndividual", "multiple", "treeViewTypeFull", "treeSelectFolders", "printTextfull", "multySelectView", "withEmptyVal", "selectTable", "selectTableAction", "selectFilterWithAll", "selectFilterWithNone", "selectFilterWithEmpty", "values", "format", "help"], "unic": ["width", "regexp", "regexpErrorText", "required", "showInWeb", "dropdownView", "insertable", "addRoles", "editable", "editRoles", "filterable", "hidden", "hideInPanelIfBlocked", "warningEditPanel", "warningEditText", "warningEditRegExp", "url", "openIn", "webRoles", "logRoles", "showInXml", "apiInsertable", "apiEditable", "xmlEditRoles", "xmlRoles", "logging", "codeAction", "CodeActionOnAdd", "CodeActionOnChange", "CodeActionOnDelete", "format", "help"], "button": ["width", "column", "buttonText", "showInWeb", "dropdownView", "warningEditPanel", "warningEditText", "tableBreakBefore", "panelColor", "webRoles", "hidden", "codeAction", "uncheckAfterClick", "closeIframeAfterClick", "pressableOnOnlyRead", "format", "help"], "number": ["width", "default", "column", "intervalFilter", "unitType", "dectimalPlaces", "regexp", "round", "step", "currency", "copyOnDuplicate", "required", "showInWeb", "dropdownView", "insertable", "addRoles", "editable", "editRoles", "filterable", "hidden", "hideInPanelIfBlocked", "warningEditPanel", "warningEditText", "warningEditRegExp", "tableBreakBefore", "panelColor", "webRoles", "logRoles", "showInXml", "apiInsertable", "apiEditable", "xmlEditRoles", "xmlRoles", "logging", "code", "codeOnlyInAdd", "errorText", "codeAction", "CodeActionOnAdd", "CodeActionOnChange", "CodeActionOnDelete", "format", "help"], "select": ["width", "default", "column", "intervalFilter", "unitType", "copyOnDuplicate", "required", "showInWeb", "dropdownView", "insertable", "addRoles", "editable", "editRoles", "selectLength", "filterable", "hidden", "hideInPanelIfBlocked", "warningEditPanel", "warningEditText", "warningEditRegExp", "tableBreakBefore", "panelColor", "webRoles", "logRoles", "showInXml", "apiInsertable", "apiEditable", "xmlEditRoles", "xmlRoles", "logging", "code", "codeOnlyInAdd", "errorText", "codeAction", "CodeActionOnAdd", "CodeActionOnChange", "CodeActionOnDelete", "codeSelect", "codeSelectIndividual", "multiple", "printTextfull", "multySelectView", "withEmptyVal", "selectTable", "selectTableAction", "selectFilterWithAll", "selectFilterWithAllText", "selectFilterWithNone", "selectFilterWithNoneText", "selectFilterWithEmpty", "selectFilterWithEmptyText", "values", "format", "help"], "string": ["width", "default", "column", "regexp", "regexpErrorText", "copyOnDuplicate", "required", "showInWeb", "dropdownView", "insertable", "addRoles", "editable", "editRoles", "filterable", "hidden", "hideInPanelIfBlocked", "warningEditPanel", "warningEditText", "warningEditRegExp", "url", "openIn", "tableBreakBefore", "panelColor", "webRoles", "logRoles", "showInXml", "apiInsertable", "apiEditable", "xmlEditRoles", "xmlRoles", "logging", "code", "codeOnlyInAdd", "errorText", "codeAction", "CodeActionOnAdd", "CodeActionOnChange", "CodeActionOnDelete", "format", "help"], "listRow": ["width", "default", "column", "copyOnDuplicate", "required", "showInWeb", "dropdownView", "filterable", "hidden", "hideInPanelIfBlocked", "tableBreakBefore", "panelColor", "webRoles", "showInXml", "xmlRoles", "logging", "code", "codeOnlyInAdd", "errorText", "codeAction", "CodeActionOnAdd", "CodeActionOnChange", "CodeActionOnDelete", "format", "help"], "checkbox": ["width", "default", "column", "copyOnDuplicate", "required", "showInWeb", "dropdownView", "insertable", "addRoles", "editable", "editRoles", "filterable", "hidden", "hideInPanelIfBlocked", "warningEditPanel", "warningEditText", "tableBreakBefore", "panelColor", "webRoles", "logRoles", "showInXml", "apiInsertable", "apiEditable", "xmlEditRoles", "xmlRoles", "logging", "code", "codeOnlyInAdd", "errorText", "codeAction", "CodeActionOnAdd", "CodeActionOnChange", "CodeActionOnDelete", "format", "help"], "comments": ["width", "viewTextMaxLength", "printTextfull", "dateTime", "copyOnDuplicate", "required", "showInWeb", "dropdownView", "insertable", "addRoles", "editable", "editRoles", "hidden", "tableBreakBefore", "panelColor", "decorationColor", "webRoles", "logRoles", "showInXml", "apiInsertable", "apiEditable", "xmlEditRoles", "xmlRoles", "logging", "codeAction", "CodeActionOnAdd", "CodeActionOnChange", "CodeActionOnDelete", "format", "help"], "password": ["width", "column", "required", "showInWeb", "dropdownView", "insertable", "addRoles", "editable", "editRoles", "hidden", "warningEditPanel", "warningEditText", "tableBreakBefore", "panelColor", "webRoles", "logRoles", "showInXml", "apiInsertable", "apiEditable", "xmlEditRoles", "xmlRoles", "logging", "codeAction", "CodeActionOnAdd", "CodeActionOnChange", "CodeActionOnDelete", "format", "help"], "fieldParams": []}}, "isOn": true}, "copyOnDuplicate": {"Val": true, "isOn": true}}}', '{"v": "tables_fields"}');
-- INSERT INTO tables_fields (table_id, name, data, ord, title, category, is_del, data_src, table_name) VALUES ('{"v": "2"}', '{"v": "table_name"}', '{"v":{"type":"string","width":100,"required":false,"logging":false,"copyOnDuplicate":false,"showInWeb":true,"insertable":false,"editable":false,"filterable":false,"hidden":true,"hideInPanelIfBlocked":true,"warningEditPanel":false,"url":false,"showInXml":false,"code":{"=":"select(table:\"0\";field:\"1\";where:\"2\"=#table_id)","==strings==":["''tables","''name","''id"]},"codeOnlyInAdd":false,"format":{"f1=":"setFormat(block:true)"}}}', '{"v": "20"}', '{"v": "table_name"}', '{"v": "column"}', false, '{"v": {"url": {"Val": false, "isOn": true}, "code": {"Val": "= : select(table: ''tables''; field: ''name''; where: ''id''=#table_id )", "isOn": true}, "help": {"Val": "", "isOn": false}, "type": {"Val": "string", "isOn": true}, "width": {"Val": 100, "isOn": true}, "format": {"Val": "f1=:setFormat(block: true)", "isOn": true}, "hidden": {"Val": true, "isOn": true}, "openIn": {"Val": "iframe", "isOn": false}, "regexp": {"Val": "", "isOn": false}, "default": {"Val": "", "isOn": false}, "logging": {"Val": false, "isOn": true}, "addRoles": {"Val": ["1"], "isOn": false}, "editable": {"Val": false, "isOn": true}, "logRoles": {"Val": ["1"], "isOn": false}, "required": {"Val": false, "isOn": true}, "webRoles": {"Val": ["1"], "isOn": false}, "xmlRoles": {"Val": ["1"], "isOn": false}, "editRoles": {"Val": ["1"], "isOn": false}, "errorText": {"Val": "", "isOn": false}, "showInWeb": {"Val": true, "isOn": true}, "showInXml": {"Val": false, "isOn": true}, "codeAction": {"Val": "= :", "isOn": false}, "filterable": {"Val": false, "isOn": true}, "insertable": {"Val": false, "isOn": true}, "panelColor": {"Val": "", "isOn": false}, "apiEditable": {"Val": false, "isOn": false}, "xmlEditRoles": {"Val": ["1"], "isOn": false}, "apiInsertable": {"Val": false, "isOn": false}, "codeOnlyInAdd": {"Val": false, "isOn": true}, "CodeActionOnAdd": {"Val": false, "isOn": false}, "copyOnDuplicate": {"Val": false, "isOn": true}, "regexpErrorText": {"Val": "", "isOn": false}, "warningEditText": {"Val": "Точно изменить?", "isOn": false}, "warningEditPanel": {"Val": false, "isOn": true}, "warningEditRegExp": {"Val": "/^someValue$/", "isOn": false}, "CodeActionOnChange": {"Val": false, "isOn": false}, "CodeActionOnDelete": {"Val": false, "isOn": false}, "hideInPanelIfBlocked": {"Val": true, "isOn": true}}}', '{"v": "tables_fields"}');
-- INSERT INTO tables_fields (table_id, name, data, ord, title, category, is_del, data_src, table_name) VALUES ('{"v": "2"}', '{"v": "version"}', '{"v":{"type":"string","width":100,"required":false,"logging":false,"copyOnDuplicate":false,"showInWeb":true,"insertable":false,"editable":false,"filterable":false,"hidden":true,"hideInPanelIfBlocked":true,"warningEditPanel":false,"url":false,"showInXml":false,"code":{"=":"select(table:\"0\";field:\"1\";where:\"2\"=#table_id)","==strings==":["''tables","''name","''id"]},"codeOnlyInAdd":false,"format":{"f1=":"setFormat(block:true)"}}}', '{"v": "20"}', '{"v": "table_name"}', '{"v": "column"}', false, '{"v": {"url": {"Val": false, "isOn": true}, "code": {"Val": "= : select(table: ''tables''; field: ''name''; where: ''id''=#table_id )", "isOn": true}, "help": {"Val": "", "isOn": false}, "type": {"Val": "string", "isOn": true}, "width": {"Val": 100, "isOn": true}, "format": {"Val": "f1=:setFormat(block: true)", "isOn": true}, "hidden": {"Val": true, "isOn": true}, "openIn": {"Val": "iframe", "isOn": false}, "regexp": {"Val": "", "isOn": false}, "default": {"Val": "", "isOn": false}, "logging": {"Val": false, "isOn": true}, "addRoles": {"Val": ["1"], "isOn": false}, "editable": {"Val": false, "isOn": true}, "logRoles": {"Val": ["1"], "isOn": false}, "required": {"Val": false, "isOn": true}, "webRoles": {"Val": ["1"], "isOn": false}, "xmlRoles": {"Val": ["1"], "isOn": false}, "editRoles": {"Val": ["1"], "isOn": false}, "errorText": {"Val": "", "isOn": false}, "showInWeb": {"Val": true, "isOn": true}, "showInXml": {"Val": false, "isOn": true}, "codeAction": {"Val": "= :", "isOn": false}, "filterable": {"Val": false, "isOn": true}, "insertable": {"Val": false, "isOn": true}, "panelColor": {"Val": "", "isOn": false}, "apiEditable": {"Val": false, "isOn": false}, "xmlEditRoles": {"Val": ["1"], "isOn": false}, "apiInsertable": {"Val": false, "isOn": false}, "codeOnlyInAdd": {"Val": false, "isOn": true}, "CodeActionOnAdd": {"Val": false, "isOn": false}, "copyOnDuplicate": {"Val": false, "isOn": true}, "regexpErrorText": {"Val": "", "isOn": false}, "warningEditText": {"Val": "Точно изменить?", "isOn": false}, "warningEditPanel": {"Val": false, "isOn": true}, "warningEditRegExp": {"Val": "/^someValue$/", "isOn": false}, "CodeActionOnChange": {"Val": false, "isOn": false}, "CodeActionOnDelete": {"Val": false, "isOn": false}, "hideInPanelIfBlocked": {"Val": true, "isOn": true}}}', '{"v": "tables_fields"}');

-- INSERT INTO tables_fields (table_id, name, data, ord, title, category, is_del, data_src, table_name) VALUES ('{"v": "1"}', '{"v": "name"}', '{"v":{"type":"unic","width":120,"required":true,"regexp":"^[a-z][a-z0-9_]{2,30}$","regexpErrorText":"NAME таблицы только маленькие латинские буквы, цифры и нижнее подчеркивание от 3 до 30 символов.","showInWeb":true,"insertable":true,"editable":false,"filterable":false,"hidden":false,"hideInPanelIfBlocked":false,"warningEditPanel":false,"url":false,"showInXml":true,"apiInsertable":false,"apiEditable":false,"CodeActionOnAdd":false,"CodeActionOnChange":false,"CodeActionOnDelete":false}}', '{"v": "20"}', '{"v": "NAME таблицы"}', '{"v": "column"}', false, '{"v": {"url": {"Val": false, "isOn": true}, "help": {"Val": "", "isOn": false}, "type": {"Val": "unic", "isOn": true}, "width": {"Val": 120, "isOn": true}, "format": {"Val": "f1=:", "isOn": false}, "hidden": {"Val": false, "isOn": true}, "openIn": {"Val": "iframe", "isOn": false}, "regexp": {"Val": "^[a-z][a-z0-9_]{2,30}$", "isOn": true}, "addRoles": {"Val": ["1"], "isOn": false}, "editable": {"Val": false, "isOn": true}, "logRoles": {"Val": ["1"], "isOn": false}, "required": {"Val": true, "isOn": true}, "webRoles": {"Val": ["1"], "isOn": false}, "xmlRoles": {"Val": ["1"], "isOn": false}, "editRoles": {"Val": ["1"], "isOn": false}, "showInWeb": {"Val": true, "isOn": true}, "showInXml": {"Val": true, "isOn": true}, "codeAction": {"Val": "= :", "isOn": false}, "filterable": {"Val": false, "isOn": true}, "insertable": {"Val": true, "isOn": true}, "apiEditable": {"Val": false, "isOn": true}, "xmlEditRoles": {"Val": ["1"], "isOn": false}, "apiInsertable": {"Val": false, "isOn": true}, "CodeActionOnAdd": {"Val": false, "isOn": true}, "regexpErrorText": {"Val": "NAME таблицы только маленькие латинские буквы, цифры и нижнее подчеркивание от 3 до 30 символов.", "isOn": true}, "warningEditText": {"Val": "Точно изменить?", "isOn": false}, "warningEditPanel": {"Val": false, "isOn": true}, "warningEditRegExp": {"Val": "/^someValue$/", "isOn": false}, "CodeActionOnChange": {"Val": false, "isOn": true}, "CodeActionOnDelete": {"Val": false, "isOn": true}, "hideInPanelIfBlocked": {"Val": false, "isOn": true}}}', '{"v": "tables"}');
-- INSERT INTO tables_fields (table_id, name, data, ord, title, category, is_del, data_src, table_name) VALUES ('{"v": "1"}', '{"v": "type"}', '{"v":{"type":"select","width":120,"hidden":false,"values":{"tmp":"Временная","calcs":"Расчетная в цикле","cycles":"Циклов","simple":"Простая","globcalcs":"Расчетная в дереве"},"default":"simple","editable":false,"multiple":false,"required":true,"showInWeb":true,"showInXml":false,"codeSelect":{"=":"SelectListAssoc(table:;field:;where:;order:)"},"filterable":true,"insertable":true,"apiEditable":false,"apiInsertable":false,"codeOnlyInAdd":false,"printTextfull":false,"CodeActionOnAdd":false,"copyOnDuplicate":true,"warningEditPanel":false,"CodeActionOnChange":false,"CodeActionOnDelete":false,"codeSelectIndividual":false,"hideInPanelIfBlocked":false}}', '{"v": "30"}', '{"v": "Тип таблицы"}', '{"v": "column"}', false, '{"v": {"code": {"Val": "= : ", "isOn": false}, "help": {"Val": "", "isOn": false}, "type": {"Val": "select", "isOn": true}, "width": {"Val": 120, "isOn": true}, "format": {"Val": "f1=:", "isOn": false}, "hidden": {"Val": false, "isOn": true}, "values": {"Val": {"tmp": "Временная", "calcs": "Расчетная в цикле", "cycles": "Циклов", "simple": "Простая", "globcalcs": "Расчетная в дереве"}, "isOn": true}, "default": {"Val": "simple", "isOn": true}, "editable": {"Val": false, "isOn": true}, "logRoles": {"Val": ["1"], "isOn": false}, "multiple": {"Val": false, "isOn": true}, "required": {"Val": true, "isOn": true}, "unitType": {"Val": "", "isOn": false}, "webRoles": {"Val": ["1"], "isOn": false}, "xmlRoles": {"Val": ["1"], "isOn": false}, "editRoles": {"Val": ["1"], "isOn": false}, "errorText": {"Val": "", "isOn": false}, "showInWeb": {"Val": true, "isOn": true}, "showInXml": {"Val": false, "isOn": true}, "codeAction": {"Val": "= :", "isOn": false}, "codeSelect": {"Val": "= : SelectListAssoc(table: ; field: ; where: ; order: )", "isOn": true}, "filterable": {"Val": true, "isOn": true}, "insertable": {"Val": true, "isOn": true}, "panelColor": {"Val": "", "isOn": false}, "apiEditable": {"Val": false, "isOn": true}, "selectTable": {"Val": "bloki", "isOn": false}, "withEmptyVal": {"Val": "", "isOn": false}, "xmlEditRoles": {"Val": ["1"], "isOn": false}, "apiInsertable": {"Val": false, "isOn": true}, "codeOnlyInAdd": {"Val": false, "isOn": true}, "printTextfull": {"Val": false, "isOn": true}, "CodeActionOnAdd": {"Val": false, "isOn": true}, "copyOnDuplicate": {"Val": true, "isOn": true}, "multySelectView": {"Val": "0", "isOn": false}, "warningEditText": {"Val": "Точно изменить?", "isOn": false}, "warningEditPanel": {"Val": false, "isOn": true}, "selectTableAction": {"Val": "=: linkToPanel(table: ''''; id: ; field: )", "isOn": false}, "CodeActionOnChange": {"Val": false, "isOn": true}, "CodeActionOnDelete": {"Val": false, "isOn": true}, "codeSelectIndividual": {"Val": false, "isOn": true}, "hideInPanelIfBlocked": {"Val": false, "isOn": true}}}', '{"v": "tables"}');

-- roles

create table roles
(
    id     serial                not null
        constraint roles_pkey
            primary key,
    is_del boolean default false not null
);
create table tree
(
    id        serial                not null
        constraint tree_pkey
            primary key,
    is_del    boolean default false not null,
    parent_id jsonb   default '{"v": null}'::jsonb not null,
    top jsonb   default '{"v": null}'::jsonb not null
);
create or replace view tree__v (id, parent_id, top) as

WITH RECURSIVE temp1(id, parent_id, top) AS (
    SELECT t1.id,
           ((t1.parent_id ->> 'v'::text))::integer AS parent_id,
           t1.id                                   as top
    FROM tree t1
    WHERE ((t1.parent_id ->> 'v'::text) IS NULL)
    UNION
    SELECT t2.id,
           ((t2.parent_id ->> 'v'::text))::integer AS parent_id,
           temp1_1.top                             AS top
    FROM (tree t2
             JOIN temp1 temp1_1 ON ((temp1_1.id = ((t2.parent_id ->> 'v'::text))::integer)))
)
SELECT temp1.id,
       temp1.parent_id,
       temp1.top
FROM temp1;

create table table_categories
(
    id        serial                not null
        constraint table_categories_pkey
            primary key,
    is_del    boolean default false not null
);
create table settings
(
    id        serial                not null
        constraint settings_pkey
            primary key,
    is_del    boolean default false not null
);

create view tables_fields__v as
SELECT tables_fields.id,
       ((tables_fields.table_id ->> 'v'::text))::integer AS table_id,
       (tables_fields.category ->> 'v'::text)            AS category,
       (tables_fields.title ->> 'v'::text)               AS title,
       (tables_fields.name ->> 'v'::text)                AS name,
       (tables_fields.data ->> 'v'::text)                AS data,
       ((tables_fields.ord ->> 'v'::text))::integer      AS ord,
       ((tables_fields.version ->> 'v'::text))           AS version,
       tables_fields.is_del
FROM tables_fields;


-- tables_nonproject_calcs

create table tables_nonproject_calcs
(
    tbl_name text                      not null
        constraint tables_nonproject_calcs_pkey
            primary key,
    tbl      jsonb default '{}'::jsonb not null,
    updated  jsonb                     not null
);

create unique index tables_nonproject_calcs_name_uindex
    on tables_nonproject_calcs (tbl_name);


-- tables_calcs_connects

create table tables_calcs_connects
(
    table_id        integer not null
        constraint tables_calcs_connects_tables_id_fk
            references tables
            on update cascade on delete cascade,
    cycle_id        integer not null,
    source_table_id integer not null
        constraint tables_calcs_connects_source_table_id_fk
            references tables
            on update cascade on delete cascade,
    id              serial  not null
        constraint tables_calcs_connects_id_pk
            primary key,
    cycles_table_id integer not null
);

comment on column tables_calcs_connects.table_id is 'расчетная таблица';

create index tables_calcs_connects_cycles_table_id_index
    on tables_calcs_connects (cycles_table_id);

create unique index tables_calcs_connects_table_id_source_table_id_project_id_uinde
    on tables_calcs_connects (table_id, source_table_id, cycle_id);


create table "_log"
(
    tableid     integer                                                      not null,
    cycleid     integer,
    rowid       integer,
    field       text,
    modify_text text,
    v           text,
    action      integer                                                      not null,
    userid      integer                                                      not null,
    dt          timestamp default ('now'::text)::timestamp without time zone not null,
    from_code   boolean   default false                                      not null
);
create index _log_tableid_rowid_field_userid_index
    on _log (tableid, rowid, field, userid);
comment on column "_log".action is '1-add;2-modify;3-clear;4-delete';

create table "_comments_viewed"
(
    table_id   integer           not null,
    cycle_id   integer           not null,
    row_id     integer           not null,
    field_name text              not null,
    user_id    integer           not null,
    nums       integer default 0 not null
);

create unique index "_comments_viewed_table_id_row_id_user_id_cycle_id_field_name_ui"
    on "_comments_viewed" (table_id, row_id, user_id, cycle_id, field_name);


create table "_tmp_tables"
(
    touched    text    not null,
    user_id    integer not null,
    table_name text    not null,
    hash       text    not null,
    tbl        jsonb,
    updated    jsonb,
    constraint "_tmp_tables_pk"
        primary key (table_name, user_id, hash)
);


